/*! @yama-dev/js-multi-data-module version:0.5.0 repository:https://github.com/yama-dev/js-multi-data-module copyright:yama-dev licensed:MIT */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.MULTI_DATA_MODULE=e():t.MULTI_DATA_MODULE=e()}(window,(function(){return function(t){var e={};function a(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,a),o.l=!0,o.exports}return a.m=t,a.c=e,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)a.d(n,o,function(e){return t[e]}.bind(null,o));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=0)}([function(t,e,a){"use strict";function n(){return(n=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t}).apply(this,arguments)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}a.r(e),a.d(e,"default",(function(){return r}));var r=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,t);var a={data_type:"jsonp",data_list:null,order:"up",orderProperty:"date",filter:!1,empty:!1,jsonpCallback:"callback",fetch_timeout:1e4};if(!e.data_list||!Array.isArray(e.data_list)){try{throw new Error('Not config "data_list"')}catch(t){console.log(t.name+": "+t.message)}return!1}this.Config=n(a,e),this.Version="0.5.0",this.DataFix=[],this.DataList=[],e.on||(e.on={}),this.On={Update:e.on.Update||"",Complete:e.on.Complete||"",Fail:e.on.Fail||""},"jsonp"===this.Config.data_type&&this.GetDataJsonp(this.Config.data_list),"json"===this.Config.data_type&&this.GetDataJson(this.Config.data_list),"html"!==this.Config.data_type&&"xml"!==this.Config.data_type||this.GetDataDocument(this.Config.data_list)}var e,a,r;return e=t,(a=[{key:"GetDataJsonp",value:function(t){var e=this,a=0,n=t.length,o=(new Date).getTime();!function i(){new Promise((function(n,i){if(t[a].url){var r=document.createElement("script");t[a].url.match(/\?.*$/)?r.src="".concat(t[a].url,"&callback=").concat(e.Config.jsonpCallback,"&_=").concat(o+a):r.src="".concat(t[a].url,"?callback=").concat(e.Config.jsonpCallback,"&_=").concat(o+a),document.body.appendChild(r),window.callback=function(t){n(t)},setTimeout((function(){i("error: timeout")}),e.Config.fetch_timeout)}else i("error:not found data.")})).then((function(o){var r=o;t[a].hierarchy&&t[a].hierarchy.split(".").map((function(t){r=r[t]})),t[a].customFunction&&(r=e.CreateData(r,null,t[a].customFunction)),r?(e.DataFix=e.DataFix.concat(r),e.DataList[a]=r):e.Config.empty&&(e.DataFix=e.DataFix.concat([""]),e.DataList[a]=[]),e.OnUpdate(e.DataList[a],a),++a<n?i():e.FormatData()})).catch((function(t){e.OnFail({message:t,data:e.DataList[a]}),e.DataFix=e.DataFix.concat([""]),e.DataList[a]=[],e.OnUpdate(e.DataList[a],a),++a<n?i():e.FormatData()}))}()}},{key:"GetDataJson",value:function(t){var e=this,a=0,n=t.length,o=(new Date).getTime();!function i(){new Promise((function(n,i){if(t[a].url){var r=new XMLHttpRequest;r.onreadystatechange=function(){4===r.readyState&&200==r.status&&n(JSON.parse(r.responseText))};var c="";c=t[a].url.match(/\?.*$/)?"".concat(t[a].url,"&_=").concat(o+a):"".concat(t[a].url,"?_=").concat(o+a),r.onload=function(){},r.open("GET",c,!0),r.send(null),setTimeout((function(){i("error: timeout")}),e.Config.fetch_timeout)}else i("error:not found data.")})).then((function(o){var r=o;t[a].hierarchy&&t[a].hierarchy.split(".").map((function(t){r=r[t]})),t[a].customFunction&&(r=e.CreateData(r,null,t[a].customFunction)),r?(e.DataFix=e.DataFix.concat(r),e.DataList[a]=r):e.Config.empty&&(e.DataFix=e.DataFix.concat([""]),e.DataList[a]=[]),e.OnUpdate(e.DataList[a]),++a<n?i():e.FormatData()})).catch((function(t){e.OnFail({message:t,data:e.DataList[a]}),e.DataFix=e.DataFix.concat([""]),e.DataList[a]=[],e.OnUpdate(e.DataList[a]),++a<n?i():e.FormatData()}))}()}},{key:"GetDataDocument",value:function(t){var e=this,a=this,n=0,o=t.length,i=(new Date).getTime();!function r(){new Promise((function(o,r){var c=new XMLHttpRequest;c.onreadystatechange=function(){var t,e;4===c.readyState&&200==c.status&&("html"===a.Config.data_type&&(t={html:c.responseXML.body.innerHTML,title:c.responseXML.title,head:c.responseXML.head,body:c.responseXML.body},e=c.responseXML.body),"xml"===a.Config.data_type&&(t={html:c.responseXML,title:null,head:null,body:c.responseXML},e=c.responseXML),o([e,t]))};var s="";s=t[n].url.match(/\?.*$/)?"".concat(t[n].url,"&_=").concat(i+n):"".concat(t[n].url,"?_=").concat(i+n),c.onload=function(){},c.open("GET",s,!0),c.responseType="document",c.send(null),setTimeout((function(){r("error: timeout")}),e.Config.fetch_timeout)})).then((function(a){var i=a[0],c=a[1];t[n].customFunction&&(i=e.CreateData(i,c,t[n].customFunction)),i?(e.DataFix=e.DataFix.concat(i),e.DataList[n]=i):e.Config.empty&&(e.DataFix=e.DataFix.concat([""]),e.DataList[n]=[]),e.OnUpdate(e.DataList[n]),++n<o?r():e.FormatData()})).catch((function(t){e.OnFail({message:t,data:e.DataList[n]}),e.DataFix=e.DataFix.concat([""]),e.DataList[n]=[],e.OnUpdate(e.DataList[n]),++n<o?r():e.FormatData()}))}()}},{key:"CreateData",value:function(t,e,a){return void 0!==e?a(t,e):a(t)}},{key:"FormatData",value:function(){var t=this;if(!Array.isArray(this.DataFix))return this.OnComplete(),!1;if(this.Config.filter){var e=[];this.DataFix.map((function(a){a[t.Config.orderProperty]&&e.push(a)})),this.DataFix=e}"up"===this.Config.order&&this.DataFix.sort((function(e,a){return e[t.Config.orderProperty]?a[t.Config.orderProperty]?(e=new Date(e[t.Config.orderProperty].replace(/\./g,"/")))<(a=new Date(a[t.Config.orderProperty].replace(/\./g,"/")))?-1:e>a?1:0:-1:1})),"down"===this.Config.order&&this.DataFix.sort((function(e,a){return e[t.Config.orderProperty]?a[t.Config.orderProperty]?(e=new Date(e[t.Config.orderProperty].replace(/\./g,"/")))<(a=new Date(a[t.Config.orderProperty].replace(/\./g,"/")))?1:e>a?-1:0:-1:1})),this.OnComplete()}},{key:"OnUpdate",value:function(t,e){this.On.Update&&"function"==typeof this.On.Update&&this.On.Update(t,e)}},{key:"OnComplete",value:function(){this.On.Complete&&"function"==typeof this.On.Complete&&this.On.Complete(this.DataFix,this.DataList)}},{key:"OnFail",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.On.Fail&&"function"==typeof this.On.Fail&&this.On.Fail(t)}}])&&i(e.prototype,a),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}()}]).default}));